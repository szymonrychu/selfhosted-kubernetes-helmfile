tls:
  enabled: true
  autoGenerated: true
  usePem: true

production: true
replicaCount: 3
resources:
  requests:
    memory: 768Mi
    cpu: 50m
  limits:
    memory: 3Gi
    cpu: 750m

podLabels:
  application: keycloak

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: "kubernetes.io/hostname"
          operator: In
          values:
            - nuc1
            - nuc2
            - nuc3
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
    - labelSelector:
        matchExpressions:
        - key: application
          operator: In
          values:
          - keycloak
      topologyKey: "kubernetes.io/hostname"

service:
  type: ClusterIP
  sessionAffinity: ClientIP

ingress:
  enabled: true
  ingressClassName: nginx
  hostname: auth.szymonrichert.pl
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: "true"
  tls: true

pdb:
  create: true

metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    endpoints:
      - path: /metrics
      - path: /realms/master/metrics
      - path: /realms/Lab/metrics
  prometheusRule:
    enabled: true

postgresql:
  enabled: true
  auth:
    username: bn_keycloak
    database: bitnami_keycloak
  architecture: replication # standalone
  primary:
    podSecurityContext:
      enabled: true
      fsGroup: 1000
    containerSecurityContext:
      enabled: true
      runAsUser: 1000
      runAsNonRoot: true
    podLabels:
      application: postgresql-primary
    persistence:
      enabled: true
      storageClass: local-path
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: "kubernetes.io/hostname"
              operator: In
              values:
                - nuc1
                - nuc2
                - nuc3
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: application
              operator: In
              values:
              - postgresql-primary
          topologyKey: "kubernetes.io/hostname"
    resources:
      requests:
        memory: 64Mi
        cpu: 10m
      limits:
        memory: 256Mi
        cpu: 100m
  readReplicas:
    replicaCount: 3
    podSecurityContext:
      enabled: true
      fsGroup: 1000
    containerSecurityContext:
      enabled: true
      runAsUser: 1000
      runAsNonRoot: true
    podLabels:
      application: postgresql-readonly
    persistence:
      enabled: true
      storageClass: local-path
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: "kubernetes.io/hostname"
              operator: In
              values:
                - nuc1
                - nuc2
                - nuc3
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: application
              operator: In
              values:
              - postgresql-readonly
          topologyKey: "kubernetes.io/hostname"
    resources:
      requests:
        memory: 64Mi
        cpu: 10m
      limits:
        memory: 256Mi
        cpu: 100m
cache:
  enabled: true
